
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kfir-g.github.io/blog/2025-05-12-Understanding-Atomicity-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CA%E2%80%9D-in-ACID/">
      
      
        <link rel="prev" href="../2025-04-15-7-Quick-Tips-to-Get-Started-with-HashiCorp-Vault/">
      
      
        <link rel="next" href="../2025-06-01-Understanding-Consistency-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CC%E2%80%9D-in-ACID/">
      
      
        
      
      
      <link rel="icon" href="../../assets/logo.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>2025 05 12 Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID - Kfir's Site</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/colors.css">
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
      <link rel="stylesheet" href="../../overrides/main.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-atomicity-really-means" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Kfir&#39;s Site" class="md-header__button md-logo" aria-label="Kfir's Site" data-md-component="logo">
      
  <img src="../../assets/logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kfir's Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2025 05 12 Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Welcome to My Personal Hub

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
  
    
  
  About Me

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../podcast/" class="md-tabs__link">
          
  
  
  Podcast

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../videos/" class="md-tabs__link">
          
  
  
  Videos

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Kfir&#39;s Site" class="md-nav__button md-logo" aria-label="Kfir's Site" data-md-component="logo">
      
  <img src="../../assets/logo.jpg" alt="logo">

    </a>
    Kfir's Site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to My Personal Hub
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About Me
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blogs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-04-15-7-Quick-Tips-to-Get-Started-with-HashiCorp-Vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7 Quick Tips to Get Started with HashiCorp Vault
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    2025 05 12 Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 05 12 Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-atomicity-really-means" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Atomicity Really Means
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-simple-transfer-operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        A Simple Transfer Operation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulating-a-failure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulating a Failure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-if-you-dont-use-transactions" class="md-nav__link">
    <span class="md-ellipsis">
      
        What If You Don’t Use Transactions?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statement-level-atomicity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Statement-Level Atomicity
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraint-failures-and-runtime-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constraint Failures and Runtime Errors
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-transactions-in-application-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Transactions in Application Code
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary of Cases
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Thoughts
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-06-01-Understanding-Consistency-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CC%E2%80%9D-in-ACID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 06 01 Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-07-07-Understanding-Durability-in-PostgreSQL--A-Deep-Dive-into-the-%E2%80%9CD%E2%80%9D-in-ACID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding Durability in PostgreSQL -A Deep Dive into the “D” in ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-07-07-Understanding-Isolation-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CI%E2%80%9D-in-ACID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 07 07 Understanding Isolation in PostgreSQL: A Deep Dive into the “I” in ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-10-14-Demystifying-Nginx%3A-From-Reverse-Proxy-to-Secure-Gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 10 14 Demystifying Nginx: From Reverse Proxy to Secure Gateway
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-10-20-How-the-Browser-Works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How the Browser Works
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-11-02-Shipping-FastAPI-Like-a-Pro%3A-My-CI-CD-Pipeline-for-TinyURL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 11 02 Shipping FastAPI Like a Pro: My CI CD Pipeline for TinyURL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-11-10-Why-I-Use-curl-Instead-of-Postman%3A-Learning-HTTP-by-Feel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 11 10 Why I Use curl Instead of Postman: Learning HTTP by Feel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-11-21-From-Passive-FastAPI-Developer-to-Real-FastAPI-Engineer--Part-1%3A-ASGI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 11 21 From Passive FastAPI Developer to Real FastAPI Engineer  Part 1: ASGI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Podcast
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Podcast
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../podcast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Podcast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../podcast/example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Example Podcast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Videos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Videos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../videos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Videos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../videos/spain-devsecops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Motivating the average developer to engage in DevSecOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>2025 05 12 Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID</h1>

<hr />
<p>title: Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID
date: 2025-05-12
original_url: https://levelup.gitconnected.com/understanding-atomicity-in-postgresql-a-deep-dive-into-the-a-in-acid-5bde6fd042e3?source=rss-e0d89d1af01d------2</p>
<hr />
<p><img alt="" src="https://cdn-
images-1.medium.com/max/1024/1*by0EZDhNnatcIASaS2YoWQ.jpeg" />Photo by Thiago
Matos : <a href="https://www.pexels.com/photo/orange-led-cfl-bulb-2338672/">https://www.pexels.com/photo/orange-led-cfl-bulb-2338672/</a></p>
<p>In production systems that manage critical data- whether financial
transactions, user state, or infrastructure configuration- the integrity of
state transitions is non-negotiable. That’s where the ACID properties of
relational databases come into play.</p>
<p>This article takes a focused look at <strong>Atomicity</strong> , the first principle of
ACID. We’ll analyze how PostgreSQL enforces it, how failures are handled, and
what engineers must understand to avoid subtle consistency bugs in real-world
systems.</p>
<h3 id="what-atomicity-really-means">What Atomicity Really Means</h3>
<p>Atomicity guarantees that a <strong>transaction is all-or-nothing</strong> : every
operation in the transaction either completes successfully, or none of them
do. There is no concept of “partial success.”</p>
<p>Atomicity is enforced at the transaction level, not the statement level.
PostgreSQL ensures that even if a failure occurs midway through a transaction,
all previous operations in that transaction are automatically rolled back.</p>
<p>For reference, see the official <a href="https://www.postgresql.org/docs/current/tutorial-transactions.html">PostgreSQL Transaction
Tutorial</a>.</p>
<h3 id="a-simple-transfer-operation">A Simple Transfer Operation</h3>
<p>Consider a simplified banking example. We’ll create an accounts table and
simulate transferring funds between two accounts:</p>
<pre><code>CREATE TABLE accounts (  
    id SERIAL PRIMARY KEY,  
    name TEXT NOT NULL,  
    balance INTEGER NOT NULL CHECK (balance &gt;= 0)  
);

INSERT INTO accounts (name, balance)  
VALUES ('Alice', 1000), ('Bob', 1000);
</code></pre>
<p>Now, we implement a basic transfer operation using an explicit transaction:</p>
<pre><code>BEGIN;

UPDATE accounts SET balance = balance - 200 WHERE name = 'Alice';  
UPDATE accounts SET balance = balance + 200 WHERE name = 'Bob';

COMMIT;
</code></pre>
<p>If both statements succeed, the transaction is committed and both updates
become permanent.</p>
<h3 id="simulating-a-failure">Simulating a Failure</h3>
<p>Now let’s simulate an error that occurs in the second statement:</p>
<pre><code>BEGIN;

UPDATE accounts SET balance = balance - 200 WHERE name = 'Alice';  
-- Intentional typo: column name is misspelled  
UPDATE accounts SET balnce = balance + 200 WHERE name = 'Bob';

COMMIT;
</code></pre>
<p>PostgreSQL will raise an error:</p>
<pre><code>ERROR: column "balnce" does not exist
</code></pre>
<p>At this point, the transaction is marked as failed. No further operations are
allowed until a rollback is issued:</p>
<pre><code>ROLLBACK;
</code></pre>
<p>Although the first UPDATE ran without error, its effect is discarded because
the transaction was never successfully committed. This is atomicity in
practice.</p>
<h3 id="what-if-you-dont-use-transactions">What If You Don’t Use Transactions?</h3>
<p>When operations are issued individually without an explicit BEGIN block,
PostgreSQL executes each as its own atomic unit:</p>
<pre><code>UPDATE accounts SET balance = balance - 200 WHERE name = 'Alice';  
-- This succeeds

UPDATE accounts SET balnce = balance + 200 WHERE name = 'Bob';  
-- This fails
</code></pre>
<p>Here, Alice’s balance is reduced, but Bob never receives the funds. This
violates our consistency requirements and results in data loss.</p>
<p><strong>Lesson:</strong> without explicit transactions, the database cannot enforce
atomicity across multiple operations.</p>
<h3 id="statement-level-atomicity">Statement-Level Atomicity</h3>
<p>PostgreSQL does provide implicit transaction handling for single statements.
If a single INSERT, UPDATE, or DELETE statement fails, it is discarded
entirely and does not affect the database. However, for multiple operations
that must succeed together, atomicity is not guaranteed unless you explicitly
wrap them in a transaction.</p>
<p>Relevant documentation: <a href="https://www.postgresql.org/docs/current/sql-begin.html">PostgreSQL
BEGIN</a></p>
<h3 id="constraint-failures-and-runtime-errors">Constraint Failures and Runtime Errors</h3>
<p>PostgreSQL also enforces atomicity in the presence of constraint violations or
other runtime errors. For example, suppose we enforce that balances cannot be
negative:</p>
<pre><code>ALTER TABLE accounts ADD CONSTRAINT non_negative_balance CHECK (balance &gt;= 0);
</code></pre>
<p>Then attempt:</p>
<pre><code>BEGIN;

UPDATE accounts SET balance = balance - 1100 WHERE name = 'Alice';  
UPDATE accounts SET balance = balance + 1100 WHERE name = 'Bob';

COMMIT;
</code></pre>
<p>Alice only has 1000, so her balance would go negative. The first statement
violates the constraint, and the entire transaction is aborted. No changes are
applied.</p>
<h3 id="handling-transactions-in-application-code">Handling Transactions in Application Code</h3>
<p>Here’s how atomicity works in a real-world PostgreSQL client using Python with
<a href="https://www.psycopg.org/psycopg3/docs/basic/transactions.html">psycopg3</a>:</p>
<pre><code>import psycopg

conn = psycopg.connect("postgresql://user:pass@localhost/db")

try:  
    with conn.transaction():  
        with conn.cursor() as cur:  
            cur.execute("UPDATE accounts SET balance = balance - 200 WHERE name = 'Alice'")  
            cur.execute("UPDATE accounts SET balnce = balance + 200 WHERE name = 'Bob'")  # Bug

except Exception as e:  
    print(f"Transaction failed: {e}")
</code></pre>
<p>In this case, conn.transaction() ensures that the entire block is treated as
atomic. When the second query fails, psycopg3 automatically rolls back the
transaction. No data is persisted.</p>
<h3 id="summary-of-cases">Summary of Cases</h3>
<ul>
<li><strong>Single</strong><strong>UPDATE</strong> : Executed without an explicit transaction block, PostgreSQL treats it as an implicit transaction. It either succeeds or fails as a single atomic operation.</li>
<li><strong>Multiple</strong><strong>UPDATEs without</strong><strong>BEGIN</strong> : When multiple operations are issued individually without wrapping them in a transaction, atomicity is not guaranteed. If one statement succeeds and another fails, partial state changes can persist.</li>
<li><strong>BEGIN /</strong><strong>COMMIT with syntax or runtime error</strong> : When using an explicit transaction, any error- be it a syntax issue or constraint violation- causes the entire transaction to be rolled back. This ensures atomicity across all enclosed operations.</li>
<li><strong>Using psycopg3 with</strong><strong>with conn.transaction()</strong> : In application code, using this context manager ensures atomicity. If any exception is raised during the block, psycopg3 automatically rolls back the transaction.</li>
</ul>
<h3 id="final-thoughts">Final Thoughts</h3>
<p>PostgreSQL provides strong atomicity guarantees, but they’re only effective
when transactions are used intentionally and correctly. Multi-statement
operations should <strong>always</strong> be wrapped in an explicit transaction, and
developers must anticipate rollback paths as part of the application’s normal
flow.</p>
<p>Failing to do so can result in partial writes, corrupted state, and long-tail
data integrity bugs that are difficult to trace.</p>
<p>For more details, refer to the official documentation:</p>
<ul>
<li><a href="https://www.postgresql.org/docs/current/tutorial-transactions.html">PostgreSQL Transactions</a></li>
<li><a href="https://www.postgresql.org/docs/current/sql-begin.html">BEGIN</a></li>
<li><a href="https://www.postgresql.org/docs/current/sql-commit.html">COMMIT</a></li>
<li><a href="https://www.postgresql.org/docs/current/sql-rollback.html">ROLLBACK</a></li>
<li><a href="https://www.psycopg.org/psycopg3/docs/basic/transactions.html">psycopg3 Transactions</a></li>
</ul>
<p><img alt="" src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=5bde6fd042e3" /></p>
<hr />
<p><a href="https://levelup.gitconnected.com/understanding-atomicity-in-postgresql-
a-deep-dive-into-the-a-in-acid-5bde6fd042e3">Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in
ACID</a> was originally published in
<a href="https://levelup.gitconnected.com">Level Up Coding</a> on Medium, where people
are continuing the conversation by highlighting and responding to this story.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <div class="site-footer" style="text-align:center; padding: 1em 0;">
    <a href="https://github.com/Kfir-G" target="_blank">
        <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white" alt="GitHub">
    </a>
    <a href="https://www.linkedin.com/in/kfir-gisman/" target="_blank">
        <img src="https://img.shields.io/badge/LinkedIn-%230077B5.svg?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn">
    </a>
    <a href="mailto:kfir.gisman@gmail.com" target="_blank">
        <img src="https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white" alt="Gmail">
    </a>
    <a href="https://medium.com/@kfir-g" target="_blank">
        <img src="https://img.shields.io/badge/Medium-12100E?style=for-the-badge&logo=medium&logoColor=white" alt="Medium">
    </a>
    <a href="https://medium.com/feed/@Kfir-G" target="_blank" title="RSS Feed">
        <img src="https://img.shields.io/badge/RSS-orange?style=for-the-badge&logo=rss&logoColor=white" alt="RSS">
    </a>
    <a href="https://dev.to/kfir-g" target="_blank">
        <img src="https://img.shields.io/badge/dev.to-12100E?style=for-the-badge&logo=dev.to&logoColor=white" alt="Dev.to">
    </a>
</div>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "content.tabs.link", "content.grid", "toc.integrate"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>