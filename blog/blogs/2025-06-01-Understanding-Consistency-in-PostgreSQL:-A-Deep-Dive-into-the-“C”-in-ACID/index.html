
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://kfir-g.github.io/blog/blogs/2025-06-01-Understanding-Consistency-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CC%E2%80%9D-in-ACID/">
      
      
        <link rel="prev" href="../2025-05-12-Understanding-Atomicity-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CA%E2%80%9D-in-ACID/">
      
      
        <link rel="next" href="../2025-07-07-Understanding-Durability-in-PostgreSQL--A-Deep-Dive-into-the-%E2%80%9CD%E2%80%9D-in-ACID/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/logo.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>2025 06 01 Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID - Kfir's Site</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/colors.css">
    
      <link rel="stylesheet" href="../../../assets/css/custom.css">
    
      <link rel="stylesheet" href="../../../overrides/main.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-consistency-really-means" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Kfir&#39;s Site" class="md-header__button md-logo" aria-label="Kfir's Site" data-md-component="logo">
      
  <img src="../../../assets/logo.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kfir's Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2025 06 01 Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Welcome to My Personal Hub

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
  
    
  
  About Me

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../podcast/" class="md-tabs__link">
          
  
  
  Podcast

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../videos/" class="md-tabs__link">
          
  
  
  Videos

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Kfir&#39;s Site" class="md-nav__button md-logo" aria-label="Kfir's Site" data-md-component="logo">
      
  <img src="../../../assets/logo.jpg" alt="logo">

    </a>
    Kfir's Site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome to My Personal Hub
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About Me
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blogs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Blogs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blogs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-04-15-7-Quick-Tips-to-Get-Started-with-HashiCorp-Vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7 Quick Tips to Get Started with HashiCorp Vault
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-05-12-Understanding-Atomicity-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CA%E2%80%9D-in-ACID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 05 12 Understanding Atomicity in PostgreSQL: A Deep Dive into the “A” in ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    2025 06 01 Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 06 01 Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-consistency-really-means" class="md-nav__link">
    <span class="md-ellipsis">
      
        What Consistency Really Means
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-schema-with-invariants" class="md-nav__link">
    <span class="md-ellipsis">
      
        A Schema With Invariants
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#violating-consistency-with-a-bad-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Violating Consistency with a Bad Transaction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enforcing-business-logic-with-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enforcing Business Logic with Triggers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referential-integrity-via-foreign-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Referential Integrity via Foreign Keys
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consistency-in-application-code-python-psycopg3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Consistency in Application Code (Python + psycopg3)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary of Cases
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final Thoughts
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-07-07-Understanding-Durability-in-PostgreSQL--A-Deep-Dive-into-the-%E2%80%9CD%E2%80%9D-in-ACID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding Durability in PostgreSQL -A Deep Dive into the “D” in ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-07-07-Understanding-Isolation-in-PostgreSQL%3A-A-Deep-Dive-into-the-%E2%80%9CI%E2%80%9D-in-ACID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 07 07 Understanding Isolation in PostgreSQL: A Deep Dive into the “I” in ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-10-14-Demystifying-Nginx%3A-From-Reverse-Proxy-to-Secure-Gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 10 14 Demystifying Nginx: From Reverse Proxy to Secure Gateway
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-10-20-How-the-Browser-Works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How the Browser Works
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-11-02-Shipping-FastAPI-Like-a-Pro%3A-My-CI-CD-Pipeline-for-TinyURL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 11 02 Shipping FastAPI Like a Pro: My CI CD Pipeline for TinyURL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-11-10-Why-I-Use-curl-Instead-of-Postman%3A-Learning-HTTP-by-Feel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 11 10 Why I Use curl Instead of Postman: Learning HTTP by Feel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2025-11-21-From-Passive-FastAPI-Developer-to-Real-FastAPI-Engineer--Part-1%3A-ASGI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025 11 21 From Passive FastAPI Developer to Real FastAPI Engineer  Part 1: ASGI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Podcast
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Podcast
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../podcast/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Podcast
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Episodes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Episodes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../podcast/episodes/episode1-jod35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Episode 1 - Ssali Jonathan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Videos
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Videos
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../videos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Videos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../videos/spain-devsecops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Motivating the average developer to engage in DevSecOps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>2025 06 01 Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID</h1>

<div><hr>
<p>title: Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID
date: 2025-06-01
original_url: https://levelup.gitconnected.com/understanding-consistency-in-postgresql-a-deep-dive-into-the-c-in-acid-82ed2d1093ec?source=rss-e0d89d1af01d------2</p>
<hr>
<p><img alt="" src="https://cdn-%0Aimages-1.medium.com/max/1024/1*HjAix9wWNkXyGl1BfIvVkw.jpeg">Photo by Matheus
Viana: <a href="https://www.pexels.com/photo/orange-wall-and-sitting-boy-10216566/">https://www.pexels.com/photo/orange-wall-and-sitting-boy-10216566/</a></p>
<p>In systems where data correctness is non-negotiable- whether you’re handling
user authentication, e-commerce inventory, or hospital patient records-
<strong>Consistency</strong> is the invisible guardrail that ensures the rules of your
domain are never broken.</p>
<p>This article explores <strong>Consistency</strong> , the second principle of ACID. We’ll
walk through how PostgreSQL enforces it via constraints, how violations are
handled, and what developers need to be mindful of to avoid state corruption
in real-world systems.</p>
<h3 id="what-consistency-really-means">What Consistency Really Means</h3>
<p>Consistency ensures that a transaction brings the database from one valid
state to another. That means all defined <strong>constraints, rules, and
invariants</strong> must be satisfied before and after every transaction.</p>
<p>If any part of a transaction would leave the data in an invalid state,
PostgreSQL <strong>rejects the entire transaction-</strong> not just the failing statement-
preserving the integrity of your system.</p>
<h3 id="a-schema-with-invariants">A Schema With Invariants</h3>
<p>Let’s return to our simple banking system and define some rules we want
PostgreSQL to enforce:</p>
<pre><code>CREATE TABLE accounts (  
    id SERIAL PRIMARY KEY,  
    name TEXT NOT NULL,  
    balance INTEGER NOT NULL CHECK (balance &gt;= 0),  
    UNIQUE(name)  
);
</code></pre>
<p>Here, we’ve defined:</p>
<ul>
<li>Every account must have a non-null name.</li>
<li>Balances must be zero or greater.</li>
<li>Names must be unique.</li>
</ul>
<p>These are <strong>declarative constraints</strong>. PostgreSQL uses them to guarantee that
no transaction can violate your domain rules.</p>
<h3 id="violating-consistency-with-a-bad-transaction">Violating Consistency with a Bad Transaction</h3>
<p>Say Alice tries to transfer more than she has:</p>
<pre><code>BEGIN;

UPDATE accounts SET balance = balance - 1200 WHERE name = 'Alice';  
UPDATE accounts SET balance = balance + 1200 WHERE name = 'Bob';

COMMIT;
</code></pre>
<p>If Alice only has 1000, PostgreSQL will raise:</p>
<pre><code>ERROR:  new row for relation "accounts" violates check constraint "accounts_balance_check"
</code></pre>
<p>At this point, the transaction is marked as failed and must be rolled back:</p>
<pre><code>ROLLBACK;
</code></pre>
<p><strong>Result</strong> : No changes are applied. This is Consistency at work- the
integrity rule (balance &gt;= 0) was violated, so PostgreSQL refused to apply any
part of the transaction.</p>
<h3 id="enforcing-business-logic-with-triggers">Enforcing Business Logic with Triggers</h3>
<p>Not all rules are easily encoded as column constraints. For more complex
logic- like age-based restrictions or cross-table validations- we can use
<strong>triggers</strong>.</p>
<p>Example: prevent creating users under age 18.</p>
<pre><code>CREATE OR REPLACE FUNCTION check_age()  
RETURNS TRIGGER AS $$  
BEGIN  
    IF NEW.age &lt; 18 THEN  
        RAISE EXCEPTION 'Age must be at least 18';  
    END IF;  
    RETURN NEW;  
END;  
$$ LANGUAGE plpgsql;

CREATE TRIGGER check_age_trigger  
BEFORE INSERT OR UPDATE ON users  
FOR EACH ROW  
EXECUTE FUNCTION check_age();
</code></pre>
<p>Now, any INSERT or UPDATE that violates this rule will automatically fail, and
the transaction will be rolled back- keeping the system in a consistent state.</p>
<h3 id="referential-integrity-via-foreign-keys">Referential Integrity via Foreign Keys</h3>
<p>Let’s introduce a transactions table that logs money transfers:</p>
<pre><code>CREATE TABLE transactions (  
    id SERIAL PRIMARY KEY,  
    from_account INTEGER REFERENCES accounts(id),  
    to_account INTEGER REFERENCES accounts(id),  
    amount INTEGER NOT NULL CHECK (amount &gt; 0)  
);
</code></pre>
<p>PostgreSQL ensures that both from_account and to_account actually exist.
Attempting to insert a transaction for a non-existent account will fail
immediately.</p>
<pre><code>INSERT INTO transactions (from_account, to_account, amount)  
VALUES (999, 2, 100);


ERROR:  insert or update on table "transactions" violates foreign key constraint
</code></pre>
<p>That’s PostgreSQL maintaining consistency via <strong>referential integrity</strong>.</p>
<h3 id="consistency-in-application-code-python-psycopg3">Consistency in Application Code (Python + psycopg3)</h3>
<p>Here’s how consistency violations behave in real-world application code:</p>
<pre><code>import psycopg

conn = psycopg.connect("postgresql://user:pass@localhost/db")

try:  
    with conn.transaction():  
        with conn.cursor() as cur:  
            cur.execute("UPDATE accounts SET balance = balance - 1200 WHERE name = 'Alice'")  
            cur.execute("UPDATE accounts SET balance = balance + 1200 WHERE name = 'Bob'")

except Exception as e:  
    print(f"Transaction failed: {e}")
</code></pre>
<p>If the balance - 1200 fails the CHECK constraint, the entire block is rolled
back. You’ll never end up in a partial state where Alice lost money but Bob
gained nothing.</p>
<h3 id="summary-of-cases">Summary of Cases</h3>
<ul>
<li><strong>Constraint violations</strong> : Cause immediate rollback of the entire transaction.</li>
<li><strong>Triggers</strong> : Allow custom rules that extend beyond column-level checks.</li>
<li><strong>Foreign key violations</strong> : Prevent inconsistent references between tables.</li>
<li><strong>Application-level transactions</strong> : psycopg3 ensures that rule violations bubble up cleanly, triggering a rollback.</li>
</ul>
<h3 id="final-thoughts">Final Thoughts</h3>
<p>Consistency is the safety net that protects your data from logical corruption.
PostgreSQL’s constraint system- combined with triggers and foreign keys-
ensures that your application’s data model is always honored.</p>
<p>If you’re building systems where correctness matters, you must treat
consistency as a first-class design concern. Don’t rely on application code
alone to enforce business rules- declarative constraints and transactional
integrity are your best allies.</p>
<p><strong>Further Reading:</strong></p>
<ul>
<li><a href="https://www.postgresql.org/docs/current/ddl-constraints.html">PostgreSQL Constraints</a></li>
<li><a href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK">PostgreSQL Foreign Keys</a></li>
<li><a href="https://www.postgresql.org/docs/current/plpgsql-trigger.html">Triggers</a></li>
<li><a href="https://www.psycopg.org/psycopg3/docs/basic/transactions.html">psycopg3 Transactions</a></li>
</ul>
<p><img alt="" src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=82ed2d1093ec"></p>
<hr>
<p><a href="https://levelup.gitconnected.com/understanding-consistency-in-%0Apostgresql-a-deep-dive-into-the-c-in-acid-82ed2d1093ec">Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in
ACID</a> was originally
published in <a href="https://levelup.gitconnected.com">Level Up Coding</a> on Medium,
where people are continuing the conversation by highlighting and responding to
this story.</p></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <div class="site-footer" style="text-align:center; padding: 1em 0;">
    <a href="https://github.com/Kfir-G" target="_blank">
        <img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white" alt="GitHub">
    </a>
    <a href="https://www.linkedin.com/in/kfir-gisman/" target="_blank">
        <img src="https://img.shields.io/badge/LinkedIn-%230077B5.svg?style=for-the-badge&logo=linkedin&logoColor=white" alt="LinkedIn">
    </a>
    <a href="mailto:kfir.gisman@gmail.com" target="_blank">
        <img src="https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white" alt="Gmail">
    </a>
    <a href="https://medium.com/@kfir-g" target="_blank">
        <img src="https://img.shields.io/badge/Medium-12100E?style=for-the-badge&logo=medium&logoColor=white" alt="Medium">
    </a>
    <a href="https://medium.com/feed/@Kfir-G" target="_blank" title="RSS Feed">
        <img src="https://img.shields.io/badge/RSS-orange?style=for-the-badge&logo=rss&logoColor=white" alt="RSS">
    </a>
    <a href="https://dev.to/kfir-g" target="_blank">
        <img src="https://img.shields.io/badge/dev.to-12100E?style=for-the-badge&logo=dev.to&logoColor=white" alt="Dev.to">
    </a>
</div>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "content.tabs.link", "content.grid", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>