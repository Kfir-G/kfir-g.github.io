<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Securing Docker: Non-Root User Best Practices</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Securing Docker: Non-Root User Best Practices</h1>
</header>
<section data-field="subtitle" class="p-summary">
Docker is a containerization platform that simplifies the deployment and scaling of applications by packaging them into lightweight…
</section>
<section data-field="body" class="e-content">
<section name="7fd7" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9292" id="9292" class="graf graf--h3 graf--leading graf--trailing graf--title">Securing Docker: Non-Root User Best Practices</h3></div></div></section><section name="d474" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="ad0f" id="ad0f" class="graf graf--p graf--leading"><a href="https://www.docker.com/" data-href="https://www.docker.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Docker</a> is a containerization platform that simplifies the deployment and scaling of applications by packaging them into lightweight, portable units called containers. A Docker image is a standalone, executable package that includes everything needed to run a software application, including the code, runtime, libraries, and system tools. Images serve as the foundation for creating containers, enabling consistent and efficient application deployment across various environments.</p><p name="2a4e" id="2a4e" class="graf graf--p graf-after--p">Docker gained <a href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" data-href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">popularity</a> among developers for revolutionising application deployment through containerization. Its lightweight, portable containers provided a consistent environment, simplifying the development and deployment process. Docker’s ease of use, compatibility across different platforms, and efficient resource utilisation contributed to its rapid adoption, empowering developers to build, ship, and run applications seamlessly across diverse environments.</p><p name="e061" id="e061" class="graf graf--p graf-after--p">Docker, like any software, is not immune to <a href="https://www.docker.com/blog/container-security-and-why-it-matters/" data-href="https://www.docker.com/blog/container-security-and-why-it-matters/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">vulnerabilities</a>. As containerization technology evolves, security concerns arise. Users must remain vigilant, regularly updating and monitoring Docker images to address potential vulnerabilities and ensure a secure deployment environment.</p><p name="4ce1" id="4ce1" class="graf graf--p graf-after--p">Granting a non-root user access within a Docker container serves as a simple yet impactful example to illustrate vulnerabilities in Docker, emphasising the importance of maintaining security best practices.</p><p name="9c5e" id="9c5e" class="graf graf--p graf-after--p">Running Docker containers with root user privileges can pose security risks for several reasons:</p><ol class="postList"><li name="c850" id="c850" class="graf graf--li graf-after--p">Privilege Escalation: Running containers as the root user may provide a path for privilege escalation. If an attacker can exploit a vulnerability within the container, they might be able to escalate their privileges and gain control of the underlying host system.</li><li name="9b92" id="9b92" class="graf graf--li graf-after--li">Increased Attack Surface: Allowing a Docker container to run as the root user increases the potential attack surface. If an attacker gains control of a container with root privileges, they may have more options to exploit vulnerabilities and compromise the host system.</li><li name="d43c" id="d43c" class="graf graf--li graf-after--li">File System Access: Root access within a container means unrestricted access to the file system. This could lead to unintended modifications or deletions of critical system files, potentially causing system instability or data loss.</li><li name="de7f" id="de7f" class="graf graf--li graf-after--li">User Namespace Isolation: Docker containers leverage user namespaces to provide some level of isolation between the container and host system users. Running containers as a non-root user ensures that even if an attacker gains access to the container, they won’t automatically have root access on the host.</li><li name="eff5" id="eff5" class="graf graf--li graf-after--li">Security Best Practices: Following security best practices is essential to minimise potential vulnerabilities. Running containers with the least privilege necessary is a fundamental principle in container security. By using a non-root user, you adhere to the principle of least privilege, limiting the potential impact of security breaches.</li></ol><p name="5270" id="5270" class="graf graf--p graf-after--li">Utilising a non-root user in Docker implementing the least privilege principle outlined in <a href="https://owasp.org/www-community/Access_Control" data-href="https://owasp.org/www-community/Access_Control" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">OWASP Access Control</a> guidelines. This practice is discouraged, as highlighted in both the <a href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" data-href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">OWASP Docker Security Sheets</a>, specifically in rule #2 “set a user,” and the <a href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" data-href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">CIS Docker Benchmark V1.6.0</a> under “4.1 — Ensure that a user for the container has been created (Manual).” Following these guidelines improves container security by limiting unnecessary permissions and lessening the chance of security issues.</p><p name="1936" id="1936" class="graf graf--p graf-after--p">With a non-root user in a Dockerfile, you’d include the “USER” instruction, such as “USER myuser,” to switch to a less privileged identity. Without it, the default is running as root. In a “docker run” command, specifying a user involves the “-u” flag, like “docker run -u 1000” where 1000 is the user ID. These code snippets illustrate how to set and manage user permissions within a Docker image, promoting security by minimising the use of elevated privileges.</p><p name="17a0" id="17a0" class="graf graf--p graf-after--p">Negative Test:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="1a39" id="1a39" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># Example Negative</span><br /><br /><span class="hljs-comment"># Uses Ubuntu as a parent image</span><br />FROM ubuntu:22.04<br /><br /><span class="hljs-comment"># Create a non-root user and switch to it</span><br />RUN useradd -m myuser<br />USER myuser<br /><br /><span class="hljs-comment"># When the container launches, bash shell also launches</span><br />CMD [<span class="hljs-string">&quot;/bin/bash&quot;</span>]`</span></pre><p name="5f4e" id="5f4e" class="graf graf--p graf-after--pre">Positive Test:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="eccc" id="eccc" class="graf graf--pre graf-after--p graf--trailing graf--preV2"><span class="pre--content"><span class="hljs-comment">#Example Positive</span><br /><br /><span class="hljs-comment"># Uses Ubuntu as a parent image</span><br />FROM ubuntu:22.04<br /><br /><span class="hljs-comment"># When the container launches, bash shell also launches</span><br />CMD [<span class="hljs-string">&quot;/bin/bash&quot;</span>]</span></pre></div></div></section><section name="51ff" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="887f" id="887f" class="graf graf--h3 graf--leading">Demonstration of acquiring non-root access in a Dockerfile</h3><p name="99f7" id="99f7" class="graf graf--p graf-after--h3">This Demo violation of Privilege Escalation, File System Access and Security Best Practice.</p><h4 name="4271" id="4271" class="graf graf--h4 graf-after--p">What Is passwd File</h4><p name="7af9" id="7af9" class="graf graf--p graf-after--h4">The <code class="markup--code markup--p-code">/etc/passwd</code> file inside a Docker container is a standard system file that stores user account information. It is commonly used on Unix-like operating systems, including Linux. Each line in the file represents a user account and contains various pieces of information about that user.</p><p name="6d2c" id="6d2c" class="graf graf--p graf-after--p">The typical format of a line in the <code class="markup--code markup--p-code">/etc/passwd</code> file is as follows:</p><p name="c765" id="c765" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">username:password:userID:groupID:userInfo:homeDirectory:loginShell</code></p><p name="fafe" id="fafe" class="graf graf--p graf-after--p">Here’s a breakdown of the fields:</p><p name="b2d0" id="b2d0" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--p-strong">username:</strong> The name of the user.<br><strong class="markup--strong markup--p-strong">password:</strong> Usually represented by ‘x,’ indicating that the actual encrypted password is stored in the /etc/shadow file or another secure location.<br><strong class="markup--strong markup--p-strong">userID (UID):</strong> A unique numerical identifier for the user.<br><strong class="markup--strong markup--p-strong">groupID (GID):</strong> The numerical identifier of the user’s primary group.<br>userInfo: Additional information about the user (often the full name).<br><strong class="markup--strong markup--p-strong">homeDirectory:</strong> The user’s home directory, where they typically start when they log in.<br><strong class="markup--strong markup--p-strong">loginShell:</strong> The user’s default shell.</code></p><h4 name="1425" id="1425" class="graf graf--h4 graf-after--p">Why Is It Demonstrate Insecure Exploit</h4><p name="01a4" id="01a4" class="graf graf--p graf-after--h4">In a typical Unix-like system, including Linux, the <code class="markup--code markup--p-code">/etc/passwd</code> file is used to store user account information, and traditionally it has read permissions for all users. The permissions might look something like:</p><p name="d655" id="d655" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">-rw-r — r — 1 root root 1153 Dec 8 12:34 /etc/passwd</code></p><p name="1a97" id="1a97" class="graf graf--p graf-after--p">Here, the file is readable by everyone, but only writable by the root user. If a non-root user has the ability to write to the<code class="markup--code markup--p-code"> /etc/passwd</code> file, it can potentially lead to security vulnerabilities and risks. Here are a few reasons why:</p><ol class="postList"><li name="eb2f" id="eb2f" class="graf graf--li graf-after--p">User Privilege Escalation: If a non-root user can write to the <code class="markup--code markup--li-code">/etc/passwd</code> file, they may be able to manipulate the entries within it. This could include modifying the UID (user ID) or GID (group ID) of existing users, potentially allowing the non-root user to escalate their privileges.</li><li name="675b" id="675b" class="graf graf--li graf-after--li">User Identity Spoofing: By modifying the <code class="markup--code markup--li-code">/etc/passwd</code> file, a non-root user might be able to impersonate other users or gain unauthorised access to resources associated with those users. This could lead to security breaches and unauthorised access.</li><li name="4cfd" id="4cfd" class="graf graf--li graf-after--li">System Integrity: The <code class="markup--code markup--li-code">/etc/passwd</code> file is crucial for the proper functioning of the system. If its contents are tampered with, it could result in system instability, errors, or disruptions in user authentication.</li><li name="61b8" id="61b8" class="graf graf--li graf-after--li">Container Escape: If this manipulation occurs within a containerized environment, it might be used as part of a larger attack to escape the container and gain unauthorised access to the host system.</li></ol><h4 name="2839" id="2839" class="graf graf--h4 graf-after--li">Demo</h4><p name="96cc" id="96cc" class="graf graf--p graf-after--h4">I executed the docker build command on the preceding positive and negative Dockerfile tests (that appears above), followed by the docker run command. In the positive test, where the Dockerfile lacked a “USER” field, I utilised a <code class="markup--code markup--p-code">echo “test” &gt;&gt; /etc/passwd</code> command to illustrate gaining command access. Conversely, in the negative test with the “USER” field, I demonstrated the prevention of gaining root user control.</p><figure name="6df7" id="6df7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7Oj4PLN8zLK1v-CxN32zvQ.png" data-width="845" data-height="114" src="https://cdn-images-1.medium.com/max/800/1*7Oj4PLN8zLK1v-CxN32zvQ.png"><figcaption class="imageCaption">Negative Test</figcaption></figure><figure name="687f" id="687f" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*ybZWBBtKcghfl0Srph3xvg.png" data-width="845" data-height="114" src="https://cdn-images-1.medium.com/max/800/1*ybZWBBtKcghfl0Srph3xvg.png"><figcaption class="imageCaption">Positive Test</figcaption></figure><h4 name="7406" id="7406" class="graf graf--h4 graf-after--figure">Conclusion</h4><p name="42c5" id="42c5" class="graf graf--p graf-after--h4">In conclusion, Docker has completely transformed the landscape of application deployment through its innovative containerization platform. It provides developers with agile and portable containers, streamlining development workflows. The widespread adoption of Docker can be attributed to its user-friendly interface, compatibility across various platforms, and efficient resource utilization. However, as containerization technology evolves, it introduces security challenges, particularly in vulnerability management.</p><p name="ebd5" id="ebd5" class="graf graf--p graf-after--p">To tackle these issues, it’s crucial to follow best practices and guidelines from OWASP and the CIS Docker Benchmark. Avoiding giving root user privileges in Docker containers is an important security step, as shown by messing with the <code class="markup--code markup--p-code">/etc/passwd</code> file, which exposes potential risks in managing user account information.Securing Docker environments depends on managing users properly, highlighting the importance of using non-root users in Dockerfiles and runtime configurations.</p><p name="987a" id="987a" class="graf graf--p graf-after--p graf--trailing">As developers, incorporating these practices is paramount for mitigating security risks and ensuring the establishment of a robust and secure deployment environment.</p></div></div></section><section name="f98c" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="b5bd" id="b5bd" class="graf graf--h4 graf--leading">References</h4><p name="9a99" id="9a99" class="graf graf--p graf-after--h4"><a href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" data-href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/</a></p><p name="5637" id="5637" class="graf graf--p graf-after--p"><a href="https://www.docker.com/blog/container-security-and-why-it-matters/" data-href="https://www.docker.com/blog/container-security-and-why-it-matters/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.docker.com/blog/container-security-and-why-it-matters/</a></p><p name="2432" id="2432" class="graf graf--p graf-after--p"><a href="https://linuxize.com/post/etc-passwd-file/" data-href="https://linuxize.com/post/etc-passwd-file/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://linuxize.com/post/etc-passwd-file/</a></p><p name="fd55" id="fd55" class="graf graf--p graf-after--p"><a href="https://owasp.org/www-community/Access_Control" data-href="https://owasp.org/www-community/Access_Control" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://owasp.org/www-community/Access_Control</a></p><p name="0d52" id="0d52" class="graf graf--p graf-after--p"><a href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" data-href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user</a></p><p name="f11b" id="f11b" class="graf graf--p graf-after--p"><a href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" data-href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6</a></p><p name="9ba6" id="9ba6" class="graf graf--p graf-after--p graf--trailing"><a href="https://docs.docker.com/engine/reference/builder/#user" data-href="https://docs.docker.com/engine/reference/builder/#user" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://docs.docker.com/engine/reference/builder/#user</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@Kfir-G" class="p-author h-card">Kfir Gisman</a> on <a href="https://medium.com/p/5784ac25e755"><time class="dt-published" datetime="2023-12-29T12:32:00.413Z">December 29, 2023</time></a>.</p><p><a href="https://medium.com/@Kfir-G/securing-docker-non-root-user-best-practices-5784ac25e755" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 20, 2025.</p></footer></article></body></html>