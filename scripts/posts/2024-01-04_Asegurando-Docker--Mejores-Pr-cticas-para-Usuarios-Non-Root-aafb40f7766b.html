<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Asegurando Docker: Mejores Prácticas para Usuarios Non-Root</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Asegurando Docker: Mejores Prácticas para Usuarios Non-Root</h1>
</header>
<section data-field="subtitle" class="p-summary">
Docker es una plataforma de contenerización que simplifica la implementación y escalabilidad de aplicaciones al empaquetarlas en unidades…
</section>
<section data-field="body" class="e-content">
<section name="9359" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="15e4" id="15e4" class="graf graf--h3 graf--leading graf--trailing graf--title">Asegurando Docker: Mejores Prácticas para Usuarios Non-Root</h3></div></div></section><section name="8643" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="0e99" id="0e99" class="graf graf--p graf--leading"><a href="https://www.docker.com/" data-href="https://www.docker.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Docker</a> es una plataforma de contenerización que simplifica la implementación y escalabilidad de aplicaciones al empaquetarlas en unidades ligeras y portátiles llamadas contenedores. Una imagen de Docker es un paquete ejecutable independiente que incluye todo lo necesario para ejecutar una aplicación de software, como el código, el tiempo de ejecución, las bibliotecas y las herramientas del sistema. Las imágenes sirven como base para la creación de contenedores, permitiendo una implementación consistente y eficiente de aplicaciones en diversos entornos.</p><p name="bd24" id="bd24" class="graf graf--p graf-after--p">Docker ganó <a href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" data-href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">popularidad</a> entre los desarrolladores al revolucionar la implementación de aplicaciones mediante la contenerización. Sus contenedores ligeros y portátiles ofrecieron un entorno consistente, simplificando el proceso de desarrollo e implementación. La facilidad de uso de Docker, su compatibilidad en diferentes plataformas y la eficiente utilización de recursos contribuyeron a su rápida adopción, capacitando a los desarrolladores para construir, enviar y ejecutar aplicaciones de manera fluida en entornos diversos.</p><p name="4beb" id="4beb" class="graf graf--p graf-after--p">Docker, al igual que cualquier software, no está exento de <a href="https://www.docker.com/blog/container-security-and-why-it-matters/" data-href="https://www.docker.com/blog/container-security-and-why-it-matters/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">vulnerabilidades</a>. A medida que la tecnología de contenerización evoluciona, surgen preocupaciones de seguridad. Los usuarios deben permanecer atentos, actualizando y monitoreando regularmente las imágenes de Docker para abordar posibles vulnerabilidades y garantizar un entorno de implementación seguro.</p><p name="9ded" id="9ded" class="graf graf--p graf-after--p">Conceder acceso a un usuario<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> </em></strong><em class="markup--em markup--p-em">non-root</em><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> </em></strong>dentro de un contenedor de Docker sirve como un ejemplo simple pero impactante para ilustrar vulnerabilidades en Docker, enfatizando la importancia de mantener las mejores prácticas de seguridad.</p><p name="1652" id="1652" class="graf graf--p graf-after--p">Ejecutar contenedores de Docker con privilegios de usuario <em class="markup--em markup--p-em">root</em> puede plantear riesgos de seguridad por varias razones:</p><ol class="postList"><li name="5d25" id="5d25" class="graf graf--li graf-after--p">Escalada de privilegios: Ejecutar contenedores como usuario <em class="markup--em markup--li-em">root</em> puede proporcionar una vía para la elevación de privilegios. Si un atacante puede explotar una vulnerabilidad dentro del contenedor, podría lograr la escalada de sus privilegios y tomar el control del sistema subyacente del host.</li><li name="1472" id="1472" class="graf graf--li graf-after--li">Aumento de la superficie de ataque: Permitir que un contenedor de Docker se ejecute como usuario <em class="markup--em markup--li-em">root</em> aumenta la superficie de ataque potencial. Si un atacante obtiene el control de un contenedor con privilegios de <em class="markup--em markup--li-em">root</em>, puede tener más opciones para explotar vulnerabilidades y comprometer el sistema host.</li><li name="b36b" id="b36b" class="graf graf--li graf-after--li">Acceso al sistema de archivos: El acceso <em class="markup--em markup--li-em">root</em> dentro de un contenedor significa acceso irrestricto al sistema de archivos. Esto podría llevar a modificaciones o eliminaciones no deseadas de archivos críticos del sistema, potencialmente causando inestabilidad del sistema o pérdida de datos.</li><li name="0f85" id="0f85" class="graf graf--li graf-after--li">Aislamiento de espacio de nombres de usuario: Los contenedores de Docker aprovechan los espacios de nombres de usuarios para proporcionar cierto nivel de aislamiento entre los usuarios del contenedor y del sistema host. Ejecutar contenedores como un usuario <em class="markup--em markup--li-em">non-root</em> garantiza que, incluso si un atacante obtiene acceso al contenedor, no tendrá automáticamente acceso de <em class="markup--em markup--li-em">root</em> en el host.</li><li name="9d18" id="9d18" class="graf graf--li graf-after--li">Mejores prácticas de seguridad: Seguir las mejores prácticas de seguridad es esencial para minimizar posibles vulnerabilidades. Ejecutar contenedores con el menor privilegio necesario es un principio fundamental en la seguridad de contenedores. Al utilizar un usuario<em class="markup--em markup--li-em"> non-root</em>, se adhiere al principio de menor privilegio, limitando el impacto potencial de violaciones de seguridad.</li></ol><p name="03b2" id="03b2" class="graf graf--p graf-after--li">Utilizar un usuario <em class="markup--em markup--p-em">non-root</em> en Docker es implementar el principio de menor privilegio delineado en las pautas de Control de Acceso de <a href="https://owasp.org/www-community/Access_Control" data-href="https://owasp.org/www-community/Access_Control" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">OWASP</a>. Esta práctica está desaconsejada, como se destaca tanto en <a href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" data-href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">las Hojas de Seguridad de OWASP Docker</a>, específicamente en la regla n.º 2 “establecer un usuario”, como en el <a href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" data-href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">CIS Docker Benchmark V1.6.0</a> bajo “4.1 — Asegurarse de que se haya creado un usuario para el contenedor (Manual)”. Seguir estas pautas mejora la seguridad del contenedor al limitar permisos innecesarios y reducir la posibilidad de problemas de seguridad.</p><p name="7945" id="7945" class="graf graf--p graf-after--p">Con un usuario <em class="markup--em markup--p-em">non-root</em> en un Dockerfile, incluye la instrucción “USER”, como “USER myuser”, para cambiar a una identidad menos privilegiada. Sin ella, el valor predeterminado es ejecutarse como <em class="markup--em markup--p-em">root</em>. En un comando “docker run”, especificar un usuario implica el uso de la bandera “-u”, por ejemplo, “docker run -u 1000”, donde 1000 es el ID de usuario. Estos fragmentos de código ilustran cómo establecer y gestionar los permisos de usuario dentro de una imagen de Docker, promoviendo la seguridad al minimizar el uso de privilegios elevados.</p><p name="bfd7" id="bfd7" class="graf graf--p graf-after--p">Test Negativo:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="8a69" id="8a69" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># Example Negative</span><br /><br /><span class="hljs-comment"># Uses Ubuntu as a parent image</span><br />FROM ubuntu:22.04<br /><br /><span class="hljs-comment"># Create a non-root user and switch to it</span><br />RUN useradd -m myuser<br />USER myuser<br /><br /><span class="hljs-comment"># When the container launches, bash shell also launches</span><br />CMD [<span class="hljs-string">&quot;/bin/bash&quot;</span>]`</span></pre><p name="4f41" id="4f41" class="graf graf--p graf-after--pre">Test Positivo:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="5da7" id="5da7" class="graf graf--pre graf-after--p graf--trailing graf--preV2"><span class="pre--content"><span class="hljs-comment">#Example Positive</span><br /><br /><span class="hljs-comment"># Uses Ubuntu as a parent image</span><br />FROM ubuntu:22.04<br /><br /><span class="hljs-comment"># When the container launches, bash shell also launches</span><br />CMD [<span class="hljs-string">&quot;/bin/bash&quot;</span>]</span></pre></div></div></section><section name="b6bc" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="1574" id="1574" class="graf graf--h4 graf--leading">Demostración de obtener acceso non-root en un Dockerfile:</h4><p name="4a4c" id="4a4c" class="graf graf--p graf-after--h4">Esta demostración viola los principios de Elevación de Privilegios, Acceso al Sistema de Archivos y las Mejores Prácticas de Seguridad.</p><h4 name="306a" id="306a" class="graf graf--h4 graf-after--p">¿Qué es el archivo passwd?</h4><p name="a1b3" id="a1b3" class="graf graf--p graf-after--h4">El archivo <code class="markup--code markup--p-code">/etc/passwd</code> dentro de un contenedor de Docker es un archivo de sistema estándar que almacena información de cuentas de usuario. Se utiliza comúnmente en sistemas operativos tipo Unix, incluyendo Linux. Cada línea en el archivo representa una cuenta de usuario y contiene varias piezas de información acerca de ese usuario.</p><p name="73b2" id="73b2" class="graf graf--p graf-after--p">El formato típico de una línea en el archivo <code class="markup--code markup--p-code">/etc/passwd</code> es el siguiente:</p><p name="bd26" id="bd26" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">username:password:userID:groupID:userInfo:homeDirectory:loginShell</code></p><p name="bab9" id="bab9" class="graf graf--p graf-after--p">Aquí un desglose de los campos:</p><p name="a6f4" id="a6f4" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--p-strong">username:</strong> El nombre del usuario.<br><strong class="markup--strong markup--p-strong">password:</strong> Generalmente representado por ‘x’, indicando que la contraseña cifrada real se almacena en el archivo /etc/shadow u otro lugar seguro.<br><strong class="markup--strong markup--p-strong">userID (UID):</strong> Un identificador numérico único para el usuario.<br><strong class="markup--strong markup--p-strong">groupID (GID):</strong> El identificador numérico del grupo principal del usuario.<br><strong class="markup--strong markup--p-strong">userInfo:</strong> Información adicional sobre el usuario (a menudo, el nombre completo).<br><strong class="markup--strong markup--p-strong">homeDirectory:</strong> El directorio principal del usuario, donde comúnmente inicia sesión.<br><strong class="markup--strong markup--p-strong">loginShell:</strong> La shell predeterminada del usuario.</code></p><h4 name="30a9" id="30a9" class="graf graf--h4 graf-after--p">¿Por qué demostrar un exploit inseguro?</h4><p name="e810" id="e810" class="graf graf--p graf-after--h4">En un sistema típico tipo Unix, incluido Linux, el archivo <code class="markup--code markup--p-code">/etc/passwd</code> se utiliza para almacenar información de cuentas de usuario y tradicionalmente tiene permisos de lectura para todos los usuarios. Los permisos pueden parecer así:</p><p name="8f05" id="8f05" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">-rw-r — r — 1 root root 1153 Dec 8 12:34 /etc/passwd</code></p><p name="86d4" id="86d4" class="graf graf--p graf-after--p">Aquí, el archivo es legible por todos, pero solo modificable por el usuario <em class="markup--em markup--p-em">root</em>. Si un usuario <em class="markup--em markup--p-em">non-root</em> tiene la capacidad de escribir en el archivo <code class="markup--code markup--p-code">/etc/passwd</code>, esto puede potencialmente llevar a vulnerabilidades y riesgos de seguridad. Aquí hay algunas razones:</p><ol class="postList"><li name="fd22" id="fd22" class="graf graf--li graf-after--p">Elevación de Privilegios del Usuario: Si un usuario <em class="markup--em markup--li-em">non-root</em> puede escribir en el archivo <code class="markup--code markup--li-code">/etc/passwd</code>, podría manipular las entradas en él. Esto podría incluir la modificación del UID (Identificación de Usuario) o GID (Identificación de Grupo) de usuarios existentes, permitiendo potencialmente al usuario <em class="markup--em markup--li-em">non-root</em> escalar sus privilegios.</li><li name="afd9" id="afd9" class="graf graf--li graf-after--li">Suplantación de Identidad de Usuario: Al modificar el archivo <code class="markup--code markup--li-code">/etc/passwd</code>, un usuario <em class="markup--em markup--li-em">non-root</em> podría intentar suplantar a otros usuarios o obtener acceso no autorizado a recursos asociados con esos usuarios. Esto podría provocar violaciones de seguridad y acceso no autorizado.</li><li name="baeb" id="baeb" class="graf graf--li graf-after--li">Integridad del Sistema: El archivo <code class="markup--code markup--li-code">/etc/passwd</code> es crucial para el funcionamiento adecuado del sistema. Si sus contenidos se manipulan, podría causar inestabilidad del sistema, errores o interrupciones en la autenticación de usuarios.</li><li name="3a2d" id="3a2d" class="graf graf--li graf-after--li">Escape del Contenedor: Si esta manipulación ocurre dentro de un entorno contenerizado, podría utilizarse como parte de un ataque más amplio para escapar del contenedor y obtener acceso no autorizado al sistema principal.</li></ol><h4 name="05c2" id="05c2" class="graf graf--h4 graf-after--li">Demostración</h4><p name="abcf" id="abcf" class="graf graf--p graf-after--h4">Ejecuté el comando docker build en las pruebas anteriores del Dockerfile, tanto las positivas como las negativas (que aparecen arriba), seguido del comando docker run. En la prueba positiva, donde el Dockerfile carecía de un campo “USER”, utilicé el comando <code class="markup--code markup--p-code">echo “test” &gt;&gt; /etc/passwd</code> para ilustrar el acceso al comando. Por otro lado, en la prueba negativa con el campo “USER”, demostré la prevención de obtener control de usuario <em class="markup--em markup--p-em">root</em>.</p><figure name="3ca9" id="3ca9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7Oj4PLN8zLK1v-CxN32zvQ.png" data-width="845" data-height="114" src="https://cdn-images-1.medium.com/max/800/1*7Oj4PLN8zLK1v-CxN32zvQ.png"><figcaption class="imageCaption">Test Negativo</figcaption></figure><figure name="efb9" id="efb9" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*ybZWBBtKcghfl0Srph3xvg.png" data-width="845" data-height="114" src="https://cdn-images-1.medium.com/max/800/1*ybZWBBtKcghfl0Srph3xvg.png"><figcaption class="imageCaption">Test Positivo</figcaption></figure><h4 name="19a7" id="19a7" class="graf graf--h4 graf-after--figure">Conclusión</h4><p name="2c0a" id="2c0a" class="graf graf--p graf-after--h4">En conclusión, Docker ha transformado por completo el panorama de la implementación de aplicaciones a través de su innovadora plataforma de contenerización. Proporciona a los desarrolladores contenedores ágiles y portátiles, simplificando los flujos de trabajo de desarrollo. La amplia adopción de Docker se atribuye a su interfaz fácil de usar, compatibilidad en diversas plataformas y la utilización eficiente de recursos. Sin embargo, a medida que evoluciona la tecnología de contenerización, introduce desafíos de seguridad, especialmente en la gestión de vulnerabilidades.</p><p name="5536" id="5536" class="graf graf--p graf-after--p">Para abordar estos problemas, es crucial seguir las mejores prácticas y directrices de OWASP y el CIS Docker Benchmark. Evitar otorgar privilegios de usuario <em class="markup--em markup--p-em">root</em> en los contenedores de Docker es un paso de seguridad importante, como se muestra al manipular el archivo <code class="markup--code markup--p-code">/etc/passwd</code>, lo que expone riesgos potenciales en la gestión de la información de cuentas de usuarios. Asegurar entornos de Docker depende de gestionar adecuadamente a los usuarios, resaltando la importancia de utilizar usuarios <em class="markup--em markup--p-em">non-root </em>en los Dockerfiles y configuraciones en tiempo de ejecución.</p><p name="86ce" id="86ce" class="graf graf--p graf-after--p graf--trailing">Como desarrolladores, incorporar estas prácticas es fundamental para mitigar riesgos de seguridad y asegurar el establecimiento de un entorno de implementación sólido y seguro.</p></div></div></section><section name="3f83" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="ee59" id="ee59" class="graf graf--h4 graf--leading">Referencias</h4><p name="61f2" id="61f2" class="graf graf--p graf-after--h4"><a href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" data-href="https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://www.docker.com/blog/docker-index-dramatic-growth-in-docker-usage-affirms-the-continued-rising-power-of-developers/</a></p><p name="24a1" id="24a1" class="graf graf--p graf-after--p"><a href="https://www.docker.com/blog/container-security-and-why-it-matters/" data-href="https://www.docker.com/blog/container-security-and-why-it-matters/" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://www.docker.com/blog/container-security-and-why-it-matters/</a></p><p name="068c" id="068c" class="graf graf--p graf-after--p"><a href="https://linuxize.com/post/etc-passwd-file/" data-href="https://linuxize.com/post/etc-passwd-file/" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://linuxize.com/post/etc-passwd-file/</a></p><p name="053f" id="053f" class="graf graf--p graf-after--p"><a href="https://owasp.org/www-community/Access_Control" data-href="https://owasp.org/www-community/Access_Control" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://owasp.org/www-community/Access_Control</a></p><p name="cbd1" id="cbd1" class="graf graf--p graf-after--p"><a href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" data-href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html#rule-2-set-a-user</a></p><p name="0b48" id="0b48" class="graf graf--p graf-after--p"><a href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" data-href="https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://www.cisecurity.org/insights/blog/announcing-cis-benchmark-for-docker-1-6</a></p><p name="7dab" id="7dab" class="graf graf--p graf-after--p graf--trailing"><a href="https://docs.docker.com/engine/reference/builder/#user" data-href="https://docs.docker.com/engine/reference/builder/#user" class="markup--anchor markup--p-anchor" rel="noopener ugc nofollow noopener" target="_blank">https://docs.docker.com/engine/reference/builder/#user</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@Kfir-G" class="p-author h-card">Kfir Gisman</a> on <a href="https://medium.com/p/aafb40f7766b"><time class="dt-published" datetime="2024-01-04T08:09:48.411Z">January 4, 2024</time></a>.</p><p><a href="https://medium.com/@Kfir-G/asegurando-docker-mejores-pr%C3%A1cticas-para-usuarios-non-root-aafb40f7766b" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 20, 2025.</p></footer></article></body></html>