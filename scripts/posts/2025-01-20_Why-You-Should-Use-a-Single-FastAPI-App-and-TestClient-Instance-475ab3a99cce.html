<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Why You Should Use a Single FastAPI App and TestClient Instance</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Why You Should Use a Single FastAPI App and TestClient Instance</h1>
</header>
<section data-field="subtitle" class="p-summary">
Learn why reusing a single FastAPI app and TestClient instance can simplify your testing setup and improve efficiency
</section>
<section data-field="body" class="e-content">
<section name="4106" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="ec0f" id="ec0f" class="graf graf--h3 graf--leading graf--title">Why You Should Use a Single FastAPI App and TestClient Instance</h3></div><div class="section-inner sectionLayout--outsetColumn"><figure name="fe52" id="fe52" class="graf graf--figure graf--layoutOutsetCenter graf-after--h3"><img class="graf-image" data-image-id="1*S82r3-z_rpD7SyMAxo43yg.jpeg" data-width="1920" data-height="1440" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*S82r3-z_rpD7SyMAxo43yg.jpeg"><figcaption class="imageCaption">Photo by Shawon Dutta: <a href="https://www.pexels.com/photo/beach-bluesky-beautiful-sky-blue-sea-7759874/" data-href="https://www.pexels.com/photo/beach-bluesky-beautiful-sky-blue-sea-7759874/" class="markup--anchor markup--figure-anchor" rel="noopener noreferrer noopener noopener" target="_blank">https://www.pexels.com/photo/beach-bluesky-beautiful-sky-blue-sea-7759874/</a></figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="b32a" id="b32a" class="graf graf--p graf-after--figure graf--trailing">When working with FastAPI, especially in larger projects, using <strong class="markup--strong markup--p-strong">one instance of your FastAPI app</strong> and <strong class="markup--strong markup--p-strong">one instance of </strong><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">TestClient</strong></code> across your entire project is critical for ensuring consistency, performance, and reliability. Let‚Äôs dive into why this is important and explore hands-on examples.</p></div></div></section><section name="5b45" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="155e" id="155e" class="graf graf--h3 graf--leading">1. Consistency Across the Application</h3><p name="4d68" id="4d68" class="graf graf--p graf-after--h3">Creating multiple instances of your FastAPI app can lead to inconsistencies. Each app instance has its own state, middleware, and dependency management. If you share stateful data, like in-memory storage or database connections, having multiple instances can cause unexpected behavior.</p><h3 name="395f" id="395f" class="graf graf--h3 graf-after--p">2. Improved Performance</h3><p name="368e" id="368e" class="graf graf--p graf-after--h3">Each <code class="markup--code markup--p-code">TestClient</code> creates its own HTTP connection and initializes dependencies. Using one <code class="markup--code markup--p-code">TestClient</code> reduces overhead and makes tests faster.</p><h3 name="1a55" id="1a55" class="graf graf--h3 graf-after--p">3. Avoid Initialization Issues</h3><p name="87aa" id="87aa" class="graf graf--p graf-after--h3 graf--trailing">FastAPI apps often initialize resources like database connections or background tasks during startup. Multiple instances can result in duplicate initializations or conflicts.</p></div></div></section><section name="09ec" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6795" id="6795" class="graf graf--h3 graf--leading">Hands-On Code¬†Example</h3><h4 name="1dca" id="1dca" class="graf graf--h4 graf-after--h3">Correct: One App Instance, One TestClient</h4><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="0597" id="0597" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends<br /><span class="hljs-keyword">from</span> fastapi.testclient <span class="hljs-keyword">import</span> TestClient<br /><br /><span class="hljs-comment"># Create a single FastAPI app instance</span><br />app = FastAPI()<br /><br /><span class="hljs-comment"># Simple in-memory database</span><br />database = {<span class="hljs-string">&quot;items&quot;</span>: []}<br /><br /><span class="hljs-comment"># Dependency</span><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_database</span>():<br />    <span class="hljs-keyword">return</span> database<br /><br /><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: <span class="hljs-built_in">str</span>, db=Depends(<span class="hljs-params">get_database</span>)</span>):<br />    db[<span class="hljs-string">&quot;items&quot;</span>].append(item)<br />    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Item &#x27;<span class="hljs-subst">{item}</span>&#x27; added.&quot;</span>}<br /><br /><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_items</span>(<span class="hljs-params">db=Depends(<span class="hljs-params">get_database</span>)</span>):<br />    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;items&quot;</span>: db[<span class="hljs-string">&quot;items&quot;</span>]}<br /><br /><span class="hljs-comment"># Create a single TestClient instance</span><br />client = TestClient(app)<br /><br /><span class="hljs-comment"># Tests</span><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_create_item</span>():<br />    response = client.post(<span class="hljs-string">&quot;/items/&quot;</span>, json={<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;foo&quot;</span>})<br />    <span class="hljs-keyword">assert</span> response.status_code == <span class="hljs-number">200</span><br />    <span class="hljs-keyword">assert</span> response.json() == {<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Item &#x27;foo&#x27; added.&quot;</span>}<br /><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_list_items</span>():<br />    response = client.get(<span class="hljs-string">&quot;/items/&quot;</span>)<br />    <span class="hljs-keyword">assert</span> response.status_code == <span class="hljs-number">200</span><br />    <span class="hljs-keyword">assert</span> response.json() == {<span class="hljs-string">&quot;items&quot;</span>: [<span class="hljs-string">&quot;foo&quot;</span>]}</span></pre><h4 name="4b38" id="4b38" class="graf graf--h4 graf-after--pre">Incorrect: Multiple Instances Can Cause¬†Issues</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="b63b" id="b63b" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-comment"># Incorrect: Multiple app instances</span><br />app1 = FastAPI()<br />app2 = FastAPI()<br /><br /><span class="hljs-comment"># Incorrect: Multiple TestClient instances</span><br />client1 = TestClient(app1)<br />client2 = TestClient(app2)<br /><br /><span class="hljs-comment"># Issue: State changes in client1 won&#x27;t reflect in client2</span></span></pre><h3 name="42c1" id="42c1" class="graf graf--h3 graf-after--pre">Common Issues with Multiple Instances</h3><ol class="postList"><li name="e4f5" id="e4f5" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">State Inconsistency</strong>: Shared state (like <code class="markup--code markup--li-code">database</code>) will behave independently in different app instances.</li><li name="ebdd" id="ebdd" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Multiple Dependency Initializations</strong>: Dependencies like database connections may be initialized multiple times, leading to resource exhaustion.</li><li name="55f0" id="55f0" class="graf graf--li graf-after--li graf--trailing"><strong class="markup--strong markup--li-strong">Startup/Shutdown Event Overlap</strong>: Multiple app instances trigger these events independently, causing redundant or conflicting behavior.</li></ol></div></div></section><section name="5a17" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="2492" id="2492" class="graf graf--h3 graf--leading">Best Practices</h3><h4 name="fe3d" id="fe3d" class="graf graf--h4 graf-after--h3">Structure Your Project for¬†Reuse</h4><p name="6f18" id="6f18" class="graf graf--p graf-after--h4">Create your app in a dedicated file (e.g., <code class="markup--code markup--p-code">app.py</code>) and import it where needed.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="dbae" id="dbae" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># app.py</span><br /><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br /><br />app = FastAPI()<br /><span class="hljs-comment"># Add routes here</span></span></pre><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="f526" id="f526" class="graf graf--pre graf-after--pre graf--preV2"><span class="pre--content"><span class="hljs-comment"># main.py</span><br /><span class="hljs-keyword">from</span> fastapi.testclient <span class="hljs-keyword">import</span> TestClient<br /><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app<br /><br />client = TestClient(app)</span></pre><h4 name="51bf" id="51bf" class="graf graf--h4 graf-after--pre">Use <code class="markup--code markup--h4-code">pytest</code> Fixtures for Shared Instances</h4><p name="ceb8" id="ceb8" class="graf graf--p graf-after--h4">Fixtures in <code class="markup--code markup--p-code">pytest</code> help manage shared resources like the <code class="markup--code markup--p-code">TestClient</code>:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="d9bf" id="d9bf" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> pytest<br /><span class="hljs-keyword">from</span> fastapi.testclient <span class="hljs-keyword">import</span> TestClient<br /><span class="hljs-keyword">from</span> app <span class="hljs-keyword">import</span> app<br /><br /><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span></span>)</span><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_client</span>():<br />    client = TestClient(app)<br />    <span class="hljs-keyword">yield</span> client  <span class="hljs-comment"># Ensure cleanup</span><br /><br /><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_example</span>(<span class="hljs-params">test_client</span>):<br />    response = test_client.get(<span class="hljs-string">&quot;/items/&quot;</span>)<br />    <span class="hljs-keyword">assert</span> response.status_code == <span class="hljs-number">200</span></span></pre><h3 name="b0d3" id="b0d3" class="graf graf--h3 graf-after--pre">Relevant Documentation</h3><ul class="postList"><li name="f15b" id="f15b" class="graf graf--li graf-after--h3"><a href="https://www.starlette.io/testclient/" data-href="https://www.starlette.io/testclient/" class="markup--anchor markup--li-anchor" rel="noopener noreferrer noopener" target="_blank">Starlette TestClient</a></li><li name="72ad" id="72ad" class="graf graf--li graf-after--li"><a href="https://fastapi.tiangolo.com/tutorial/testing/" data-href="https://fastapi.tiangolo.com/tutorial/testing/" class="markup--anchor markup--li-anchor" rel="noopener noreferrer noopener" target="_blank">Testing with FastAPI</a></li><li name="fbef" id="fbef" class="graf graf--li graf-after--li"><a href="https://docs.pytest.org/en/latest/how-to/fixtures.html" data-href="https://docs.pytest.org/en/latest/how-to/fixtures.html" class="markup--anchor markup--li-anchor" rel="noopener noreferrer noopener" target="_blank">pytest Fixtures</a></li></ul><p name="2241" id="2241" class="graf graf--p graf-after--li">By following these guidelines, you ensure your FastAPI project is consistent, efficient, and maintainable.</p><h3 name="2a53" id="2a53" class="graf graf--h3 graf-after--p">Thank you for being a part of the community</h3><p name="25e5" id="25e5" class="graf graf--p graf-after--h3"><em class="markup--em markup--p-em">Before you go:</em></p><ul class="postList"><li name="37fb" id="37fb" class="graf graf--li graf-after--p">Be sure to <strong class="markup--strong markup--li-strong">clap</strong> and <strong class="markup--strong markup--li-strong">follow</strong> the writer Ô∏èüëè<strong class="markup--strong markup--li-strong">Ô∏èÔ∏è</strong></li><li name="850e" id="850e" class="graf graf--li graf-after--li">Follow us: <a href="https://x.com/inPlainEngHQ" data-href="https://x.com/inPlainEngHQ" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">X</strong></a> | <a href="https://www.linkedin.com/company/inplainenglish/" data-href="https://www.linkedin.com/company/inplainenglish/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">LinkedIn</strong></a> | <a href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" data-href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">YouTube</strong></a> | <a href="https://newsletter.plainenglish.io/" data-href="https://newsletter.plainenglish.io/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Newsletter</strong></a> | <a href="https://open.spotify.com/show/7qxylRWKhvZwMz2WuEoua0" data-href="https://open.spotify.com/show/7qxylRWKhvZwMz2WuEoua0" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Podcast</strong></a></li><li name="837e" id="837e" class="graf graf--li graf-after--li"><a href="https://cofeed.app/" data-href="https://cofeed.app/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Check out CoFeed, the smart way to stay up-to-date with the latest in tech</strong></a> <strong class="markup--strong markup--li-strong">üß™</strong></li><li name="18c1" id="18c1" class="graf graf--li graf-after--li"><a href="https://differ.blog/" data-href="https://differ.blog/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Start your own free AI-powered blog on Differ</strong></a> üöÄ</li><li name="0a80" id="0a80" class="graf graf--li graf-after--li"><a href="https://discord.gg/in-plain-english-709094664682340443" data-href="https://discord.gg/in-plain-english-709094664682340443" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Join our content creators community on Discord</strong></a> üßëüèª‚Äçüíª</li><li name="2404" id="2404" class="graf graf--li graf-after--li graf--trailing">For more content, visit <a href="https://plainenglish.io/" data-href="https://plainenglish.io/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">plainenglish.io</strong></a> + <a href="https://stackademic.com/" data-href="https://stackademic.com/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">stackademic.com</strong></a></li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@Kfir-G" class="p-author h-card">Kfir Gisman</a> on <a href="https://medium.com/p/475ab3a99cce"><time class="dt-published" datetime="2025-01-20T07:27:08.884Z">January 20, 2025</time></a>.</p><p><a href="https://medium.com/@Kfir-G/why-you-should-use-a-single-fastapi-app-and-testclient-instance-475ab3a99cce" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 20, 2025.</p></footer></article></body></html>