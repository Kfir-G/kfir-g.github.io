<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID</h1>
</header>
<section data-field="subtitle" class="p-summary">
How PostgreSQL keeps your data safe from logical errors using constraints, triggers, and transactional rules
</section>
<section data-field="body" class="e-content">
<section name="f7b5" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="babd" id="babd" class="graf graf--h3 graf--leading graf--title">Understanding Consistency in PostgreSQL: A Deep Dive into the “C” in ACID</h3><figure name="f27b" id="f27b" class="graf graf--figure graf-after--h3 graf--trailing"><img class="graf-image" data-image-id="1*HjAix9wWNkXyGl1BfIvVkw.jpeg" data-width="3513" data-height="4684" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*HjAix9wWNkXyGl1BfIvVkw.jpeg"><figcaption class="imageCaption">Photo by Matheus Viana: <a href="https://www.pexels.com/photo/orange-wall-and-sitting-boy-10216566/" data-href="https://www.pexels.com/photo/orange-wall-and-sitting-boy-10216566/" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">https://www.pexels.com/photo/orange-wall-and-sitting-boy-10216566/</a></figcaption></figure></div></div></section><section name="bbd7" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="530f" id="530f" class="graf graf--p graf--leading">In systems where data correctness is non-negotiable- whether you’re handling user authentication, e-commerce inventory, or hospital patient records- <strong class="markup--strong markup--p-strong">Consistency</strong> is the invisible guardrail that ensures the rules of your domain are never broken.</p><p name="3700" id="3700" class="graf graf--p graf-after--p graf--trailing">This article explores <strong class="markup--strong markup--p-strong">Consistency</strong>, the second principle of ACID. We’ll walk through how PostgreSQL enforces it via constraints, how violations are handled, and what developers need to be mindful of to avoid state corruption in real-world systems.</p></div></div></section><section name="fa89" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="906b" id="906b" class="graf graf--h3 graf--leading">What Consistency Really Means</h3><p name="de20" id="de20" class="graf graf--p graf-after--h3">Consistency ensures that a transaction brings the database from one valid state to another. That means all defined <strong class="markup--strong markup--p-strong">constraints, rules, and invariants</strong> must be satisfied before and after every transaction.</p><p name="4fd3" id="4fd3" class="graf graf--p graf-after--p graf--trailing">If any part of a transaction would leave the data in an invalid state, PostgreSQL <strong class="markup--strong markup--p-strong">rejects the entire transaction- </strong>not just the failing statement-preserving the integrity of your system.</p></div></div></section><section name="a610" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="ac72" id="ac72" class="graf graf--h3 graf--leading">A Schema With Invariants</h3><p name="d610" id="d610" class="graf graf--p graf-after--h3">Let’s return to our simple banking system and define some rules we want PostgreSQL to enforce:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="b2d7" id="b2d7" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> accounts (<br />    id SERIAL <span class="hljs-keyword">PRIMARY</span> KEY,<br />    name TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br />    balance <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">CHECK</span> (balance <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>),<br />    <span class="hljs-keyword">UNIQUE</span>(name)<br />);</span></pre><p name="a832" id="a832" class="graf graf--p graf-after--pre">Here, we’ve defined:</p><ul class="postList"><li name="6d7a" id="6d7a" class="graf graf--li graf-after--p">Every account must have a non-null name.</li><li name="0b5f" id="0b5f" class="graf graf--li graf-after--li">Balances must be zero or greater.</li><li name="818a" id="818a" class="graf graf--li graf-after--li">Names must be unique.</li></ul><p name="328d" id="328d" class="graf graf--p graf-after--li graf--trailing">These are <strong class="markup--strong markup--p-strong">declarative constraints</strong>. PostgreSQL uses them to guarantee that no transaction can violate your domain rules.</p></div></div></section><section name="071b" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6a80" id="6a80" class="graf graf--h3 graf--leading">Violating Consistency with a Bad Transaction</h3><p name="78c7" id="78c7" class="graf graf--p graf-after--h3">Say Alice tries to transfer more than she has:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="ccf0" id="ccf0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">BEGIN</span>;<br /><br /><span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">1200</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Alice&#x27;</span>;<br /><span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">1200</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Bob&#x27;</span>;<br /><br /><span class="hljs-keyword">COMMIT</span>;</span></pre><p name="580b" id="580b" class="graf graf--p graf-after--pre">If Alice only has 1000, PostgreSQL will raise:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="2d2f" id="2d2f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">ERROR:  <span class="hljs-keyword">new</span> <span class="hljs-type">row</span> <span class="hljs-keyword">for</span> relation &quot;accounts&quot; violates <span class="hljs-keyword">check</span> <span class="hljs-keyword">constraint</span> &quot;accounts_balance_check&quot;</span></pre><p name="0f52" id="0f52" class="graf graf--p graf-after--pre">At this point, the transaction is marked as failed and must be rolled back:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="c6db" id="c6db" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">ROLLBACK</span>;</span></pre><p name="4c07" id="4c07" class="graf graf--p graf-after--pre graf--trailing"><strong class="markup--strong markup--p-strong">Result</strong>: No changes are applied. This is Consistency at work- the integrity rule (<code class="markup--code markup--p-code">balance &gt;= 0</code>) was violated, so PostgreSQL refused to apply any part of the transaction.</p></div></div></section><section name="20f2" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e9ab" id="e9ab" class="graf graf--h3 graf--leading">Enforcing Business Logic with Triggers</h3><p name="f7b6" id="f7b6" class="graf graf--p graf-after--h3">Not all rules are easily encoded as column constraints. For more complex logic- like age-based restrictions or cross-table validations- we can use <strong class="markup--strong markup--p-strong">triggers</strong>.</p><p name="7629" id="7629" class="graf graf--p graf-after--p">Example: prevent creating users under age 18.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="daa0" id="daa0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> check_age()<br /><span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">TRIGGER</span> <span class="hljs-keyword">AS</span> $$<br /><span class="hljs-keyword">BEGIN</span><br />    IF NEW.age <span class="hljs-operator">&lt;</span> <span class="hljs-number">18</span> <span class="hljs-keyword">THEN</span><br />        RAISE EXCEPTION <span class="hljs-string">&#x27;Age must be at least 18&#x27;</span>;<br />    <span class="hljs-keyword">END</span> IF;<br />    <span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">NEW</span>;<br /><span class="hljs-keyword">END</span>;<br />$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;<br /><br /><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> check_age_trigger<br />BEFORE <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> users<br /><span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span><br /><span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">FUNCTION</span> check_age();</span></pre><p name="aad3" id="aad3" class="graf graf--p graf-after--pre graf--trailing">Now, any <code class="markup--code markup--p-code">INSERT</code> or <code class="markup--code markup--p-code">UPDATE</code> that violates this rule will automatically fail, and the transaction will be rolled back- keeping the system in a consistent state.</p></div></div></section><section name="2e06" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d47b" id="d47b" class="graf graf--h3 graf--leading">Referential Integrity via Foreign Keys</h3><p name="6e70" id="6e70" class="graf graf--p graf-after--h3">Let’s introduce a <code class="markup--code markup--p-code">transactions</code> table that logs money transfers:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="8dcd" id="8dcd" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> transactions (<br />    id SERIAL <span class="hljs-keyword">PRIMARY</span> KEY,<br />    from_account <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">REFERENCES</span> accounts(id),<br />    to_account <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">REFERENCES</span> accounts(id),<br />    amount <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">CHECK</span> (amount <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br />);</span></pre><p name="9b90" id="9b90" class="graf graf--p graf-after--pre">PostgreSQL ensures that both <code class="markup--code markup--p-code">from_account</code> and <code class="markup--code markup--p-code">to_account</code> actually exist. Attempting to insert a transaction for a non-existent account will fail immediately.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="085b" id="085b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> transactions (from_account, to_account, amount)<br /><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">999</span>, <span class="hljs-number">2</span>, <span class="hljs-number">100</span>);</span></pre><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="df1e" id="df1e" class="graf graf--pre graf-after--pre graf--preV2"><span class="pre--content">ERROR:  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">table</span> &quot;transactions&quot; violates <span class="hljs-keyword">foreign</span> key <span class="hljs-keyword">constraint</span></span></pre><p name="05f5" id="05f5" class="graf graf--p graf-after--pre graf--trailing">That’s PostgreSQL maintaining consistency via <strong class="markup--strong markup--p-strong">referential integrity</strong>.</p></div></div></section><section name="75a4" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="07b6" id="07b6" class="graf graf--h3 graf--leading">Consistency in Application Code (Python + psycopg3)</h3><p name="2f41" id="2f41" class="graf graf--p graf-after--h3">Here’s how consistency violations behave in real-world application code:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="9b9a" id="9b9a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> psycopg<br /><br />conn = psycopg.connect(<span class="hljs-string">&quot;postgresql://user:pass@localhost/db&quot;</span>)<br /><br /><span class="hljs-keyword">try</span>:<br />    <span class="hljs-keyword">with</span> conn.transaction():<br />        <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cur:<br />            cur.execute(<span class="hljs-string">&quot;UPDATE accounts SET balance = balance - 1200 WHERE name = &#x27;Alice&#x27;&quot;</span>)<br />            cur.execute(<span class="hljs-string">&quot;UPDATE accounts SET balance = balance + 1200 WHERE name = &#x27;Bob&#x27;&quot;</span>)<br /><br /><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Transaction failed: <span class="hljs-subst">{e}</span>&quot;</span>)</span></pre><p name="e3aa" id="e3aa" class="graf graf--p graf-after--pre graf--trailing">If the <code class="markup--code markup--p-code">balance - 1200</code> fails the <code class="markup--code markup--p-code">CHECK</code> constraint, the entire block is rolled back. You’ll never end up in a partial state where Alice lost money but Bob gained nothing.</p></div></div></section><section name="81b7" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c56a" id="c56a" class="graf graf--h3 graf--leading">Summary of Cases</h3><ul class="postList"><li name="696e" id="696e" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Constraint violations</strong>: Cause immediate rollback of the entire transaction.</li><li name="9311" id="9311" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Triggers</strong>: Allow custom rules that extend beyond column-level checks.</li><li name="d735" id="d735" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Foreign key violations</strong>: Prevent inconsistent references between tables.</li><li name="7831" id="7831" class="graf graf--li graf-after--li graf--trailing"><strong class="markup--strong markup--li-strong">Application-level transactions</strong>: <code class="markup--code markup--li-code">psycopg3</code> ensures that rule violations bubble up cleanly, triggering a rollback.</li></ul></div></div></section><section name="cea7" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4ecf" id="4ecf" class="graf graf--h3 graf--leading">Final Thoughts</h3><p name="1b72" id="1b72" class="graf graf--p graf-after--h3">Consistency is the safety net that protects your data from logical corruption. PostgreSQL’s constraint system- combined with triggers and foreign keys- ensures that your application’s data model is always honored.</p><p name="3f21" id="3f21" class="graf graf--p graf-after--p graf--trailing">If you’re building systems where correctness matters, you must treat consistency as a first-class design concern. Don’t rely on application code alone to enforce business rules- declarative constraints and transactional integrity are your best allies.</p></div></div></section><section name="f62a" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="e46a" id="e46a" class="graf graf--p graf--leading"><strong class="markup--strong markup--p-strong">Further Reading:</strong></p><ul class="postList"><li name="a100" id="a100" class="graf graf--li graf-after--p"><a href="https://www.postgresql.org/docs/current/ddl-constraints.html" data-href="https://www.postgresql.org/docs/current/ddl-constraints.html" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">PostgreSQL Constraints</a></li><li name="4057" id="4057" class="graf graf--li graf-after--li"><a href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK" data-href="https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">PostgreSQL Foreign Keys</a></li><li name="83de" id="83de" class="graf graf--li graf-after--li"><a href="https://www.postgresql.org/docs/current/plpgsql-trigger.html" data-href="https://www.postgresql.org/docs/current/plpgsql-trigger.html" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Triggers</a></li><li name="eef0" id="eef0" class="graf graf--li graf-after--li graf--trailing"><a href="https://www.psycopg.org/psycopg3/docs/basic/transactions.html" data-href="https://www.psycopg.org/psycopg3/docs/basic/transactions.html" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">psycopg3 Transactions</a></li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@Kfir-G" class="p-author h-card">Kfir Gisman</a> on <a href="https://medium.com/p/82ed2d1093ec"><time class="dt-published" datetime="2025-06-01T22:36:31.789Z">June 1, 2025</time></a>.</p><p><a href="https://medium.com/@Kfir-G/understanding-consistency-in-postgresql-a-deep-dive-into-the-c-in-acid-82ed2d1093ec" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 20, 2025.</p></footer></article></body></html>